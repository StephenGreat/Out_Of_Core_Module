\section{Hierarchical\-Image.\-h}
\label{_hierarchical_image_8h}\index{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Hierarchical\-Image.\-h@{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Hierarchical\-Image.\-h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef \_HIERARCHICAL\_IMAGE\_H}
00002 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define \_HIERARCHICAL\_IMAGE\_H}
00003 \textcolor{preprocessor}{}
00004 \textcolor{preprocessor}{#include <string>}
00005 
00006 \textcolor{preprocessor}{#include "BlockwiseImage.h"}
00007 
00021 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{size\_t} memory\_usage = 64>
00022 \textcolor{keyword}{class }HierarchicalImage: \textcolor{keyword}{public} BlockwiseImage<T, memory\_usage>
00023 \{
00024 \textcolor{keyword}{public}:
00025 
00033         HierarchicalImage(\textcolor{keywordtype}{size\_t} rows, \textcolor{keywordtype}{size\_t} cols, \textcolor{keywordtype}{size\_t} mini\_rows, \textcolor{keywordtype}{size\_t} 
      mini\_cols,
00034                 boost::shared\_ptr<IndexMethodInterface> method = 
      boost::shared\_ptr<IndexMethodInterface>());
00035 
00036         \textcolor{keyword}{virtual} ~HierarchicalImage();
00037 
00038 \textcolor{comment}{/* Derived from BlockwiseImage */}
00039 
00040         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} write_image(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* file\_name);
00041         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} write_image(\textcolor{keyword}{const} std::string &file\_name);
00042         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} save_mini_image(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* file\_name);
00043 
00044 \textcolor{comment}{/* specific method */}
00045 
00046 \textcolor{keyword}{public}:
00047 
00054         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} set_mutliply_ways_writing_number(\textcolor{keywordtype}{size\_t} number);
00055 
00056 \textcolor{keyword}{protected}:
00057 
00063         \textcolor{keyword}{inline} \textcolor{keywordtype}{void} set_image_data_path(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name); 
00064 
00065 \textcolor{keyword}{protected}:
00066 
00070         \textcolor{keywordtype}{bool} write_image_head_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name);
00071 
00075         \textcolor{keywordtype}{bool} write_image_inner_loop(\textcolor{keywordtype}{size\_t} start\_level, \textcolor{keywordtype}{size\_t} merge\_number, \textcolor{keyword}{
      const} boost::filesystem3::path &data\_path, \textcolor{keyword}{const} int64 &file\_number);
00076 
00077 \textcolor{keyword}{protected}:
00079         \textcolor{keywordtype}{size\_t} concurrent_number;
00080 
00082         std::string img_data_path;
00083 
00085         Size img_current_level_size;
00086 \};
00087 
00088 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{size\_t} memory\_usage>
00089 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} HierarchicalImage<T, memory_usage>::set_mutliply_ways_writing_number
      (\textcolor{keywordtype}{size\_t} number) \{
00090         \textcolor{keywordtype}{size\_t} max\_number = get\_max\_image\_level() + 1;
00091         concurrent\_number = (number > max\_number) ? max\_number : number;
00092 \} 
00093 
00094 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{size\_t} memory\_usage>
00095 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} HierarchicalImage<T, memory_usage>::set_image_data_path(\textcolor{keyword}{const} \textcolor{keywordtype}{char} 
      * file\_name) 
00096 \{
00097         \textcolor{keyword}{namespace }bf = boost::filesystem3;
00098 
00099         \textcolor{comment}{/* save the img\_data\_path */}
00100         bf::path file\_path = file\_name;
00101         img\_data\_path = (file\_path.parent\_path() / file\_path.stem()).
      generic\_string();
00102 \}
00103 
00115 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00116 boost::shared\_ptr<GiantImageInterface<T> > 
      get_hierarchical_image_by_meomory_usage(\textcolor{keywordtype}{unsigned} memory\_usage,
00117         \textcolor{keywordtype}{size\_t} rows, \textcolor{keywordtype}{size\_t} cols, \textcolor{keywordtype}{size\_t} mini\_rows, \textcolor{keywordtype}{size\_t} mini\_cols,
00118         boost::shared\_ptr<IndexMethodInterface> method = 
      boost::shared\_ptr<IndexMethodInterface>())
00119 \{
00120         \textcolor{comment}{/* ensure memory\_usage is bigger than 8 */}
00121         memory\_usage = (memory\_usage < 8) ? 8 : memory\_usage;
00122 
00123         \textcolor{comment}{/* make memory\_usage = 2^order (order >=3 && order <= 12) */}
00124         \textcolor{keywordflow}{while}(memory\_usage & (memory\_usage - 1)) \{
00125                 memory\_usage &= (memory\_usage - 1);
00126         \}
00127 
00128         \textcolor{keywordflow}{switch}(memory\_usage)
00129         \{
00130         \textcolor{keywordflow}{case} 8:
00131                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 8> >(rows, cols,
       mini\_rows, mini\_cols, method);
00132         \textcolor{keywordflow}{case} 16:
00133                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 16> >(rows, cols
      , mini\_rows, mini\_cols, method);
00134         \textcolor{keywordflow}{case} 32:
00135                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 32> >(rows, cols
      , mini\_rows, mini\_cols, method);
00136         \textcolor{keywordflow}{case} 64:
00137                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 64> >(rows, cols
      , mini\_rows, mini\_cols, method);
00138         \textcolor{keywordflow}{case} 128:
00139                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 128> >(rows, 
      cols, mini\_rows, mini\_cols, method);
00140         \textcolor{keywordflow}{case} 256:
00141                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 256> >(rows, 
      cols, mini\_rows, mini\_cols, method);
00142         \textcolor{keywordflow}{case} 512:
00143                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 512> >(rows, 
      cols, mini\_rows, mini\_cols, method);
00144         \textcolor{keywordflow}{case} 1024:
00145                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 1024> >(rows, 
      cols, mini\_rows, mini\_cols, method);
00146         \textcolor{keywordflow}{case} 2048:
00147                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 2048> >(rows, 
      cols, mini\_rows, mini\_cols, method);
00148         \textcolor{keywordflow}{case} 4096:
00149                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 4096> >(rows, 
      cols, mini\_rows, mini\_cols, method);
00150         \textcolor{keywordflow}{default}:
00151                 \textcolor{keywordflow}{return} boost::make\_shared<HierarchicalImage<T, 64> >(rows, cols
      , mini\_rows, mini\_cols, method);
00152         \}
00153 \}
00154 
00160 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
