\section{Disk\-Big\-Image.\-h}
\label{_disk_big_image_8h}\index{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Disk\-Big\-Image.\-h@{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Disk\-Big\-Image.\-h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef \_DISK\_BIG\_IMAGE\_H}
00002 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define \_DISK\_BIG\_IMAGE\_H}
00003 \textcolor{preprocessor}{}
00004 \textcolor{preprocessor}{#include "BasicType.h"}
00005 \textcolor{preprocessor}{#include "DiskBigImageInterface.h"}
00006 \textcolor{preprocessor}{#include "Lru.hpp"}
00007 \textcolor{preprocessor}{#include "IndexMethod.hpp"}
00008 
00010 \textcolor{preprocessor}{#define BOOST\_FILESYSTEM\_VERSION 3}
00011 \textcolor{preprocessor}{}\textcolor{preprocessor}{#include <boost/filesystem.hpp>}
00012 \textcolor{preprocessor}{#include <boost/lexical\_cast.hpp>}
00013 
00014 \textcolor{preprocessor}{#include <vector>}
00015 
00029 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00030 \textcolor{keyword}{class }DiskBigImage : \textcolor{keyword}{public} DiskBigImageInterface<T>
00031 \{
00032 
00033 \textcolor{keyword}{public}:
00034         \textcolor{comment}{/* Derived from DiskBigImageInterface */}
00035 
00036         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} get_pixels_by_level(\textcolor{keywordtype}{int} level, \textcolor{keywordtype}{int} start\_row, \textcolor{keywordtype}{int} 
      start\_col, \textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} cols, std::vector<T> &vec);
00037         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} set\_pixel\_by\_level(\textcolor{keywordtype}{int} level, \textcolor{keywordtype}{int} start\_row, \textcolor{keywordtype}{int} start\_col
      , \textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} cols, \textcolor{keyword}{const} std::vector<T> &vec);
00038 
00039     \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} get\_pixels\_by\_level\_fast(\textcolor{keywordtype}{int} level, \textcolor{keywordtype}{int} &start\_row, \textcolor{keywordtype}{int} &
      start\_col, \textcolor{keywordtype}{int} &rows, \textcolor{keywordtype}{int} &cols, std::vector<T> &vec);
00040 
00041         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} set_current_level(\textcolor{keywordtype}{int} level);
00042         \textcolor{keyword}{virtual} \textcolor{keywordtype}{size\_t} get\_current\_level() \textcolor{keyword}{const}; 
00043 
00044         \textcolor{keyword}{virtual} \textcolor{keywordtype}{size\_t} get_current_level_image_rows() \textcolor{keyword}{const}; 
00045         \textcolor{keyword}{virtual} \textcolor{keywordtype}{size\_t} get_current_level_image_cols() \textcolor{keyword}{const};
00046 
00047         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} set_file_cache_number(\textcolor{keywordtype}{int} \_file\_cache\_number);
00048 
00049         \textcolor{keyword}{virtual} \textcolor{keywordtype}{size\_t} get_max_image_level() \textcolor{keyword}{const};
00050 
00051 \textcolor{keyword}{public}:
00052 
00060         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get_minimal_image_rows() \textcolor{keyword}{const}; 
00061         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get\_minimal\_image\_cols() \textcolor{keyword}{const};
00062 
00063 
00071         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get_image_rows() \textcolor{keyword}{const};
00072         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get\_image\_cols() \textcolor{keyword}{const};
00073 
00074 \textcolor{keyword}{protected}:
00075 
00082         \textcolor{keyword}{struct }DataIndexInfo
00083         \{
00084                 int64 index;                    
00085                 int64 zorder_index;     
00087                 \textcolor{keyword}{friend} \textcolor{keyword}{inline} \textcolor{keywordtype}{bool} operator< (\textcolor{keyword}{const} DataIndexInfo& lhs, \textcolor{keyword}{const} 
      DataIndexInfo& rhs) 
00088                 \{
00089                         \textcolor{keywordflow}{return} (lhs.zorder_index < rhs.zorder_index);
00090                 \}
00091         \};
00092 
00093 \textcolor{keyword}{protected}:
00094 
00100         \textcolor{keywordtype}{bool} read_from_index_range(\textcolor{keywordtype}{size\_t} front, \textcolor{keywordtype}{size\_t} tail, 
      ZOrderIndex::IndexType start\_index, 
00101                 \textcolor{keyword}{const} std::vector<DataIndexInfo> &index\_info\_vector, 
      std::vector<T> &data\_vector);
00102 
00106         \textcolor{keywordtype}{bool} check_para_validation(\textcolor{keywordtype}{int} level, \textcolor{keywordtype}{int} start\_row, \textcolor{keywordtype}{int} start\_col, \textcolor{keywordtype}{int}
       rows, \textcolor{keywordtype}{int} cols);
00107 
00111         \textcolor{keywordtype}{bool} load_image_head_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name);
00112 
00116         \textcolor{keywordtype}{void} set_image_data_path(\textcolor{keyword}{const} \textcolor{keywordtype}{char} * file\_name);
00117 
00118 \textcolor{keyword}{protected}:
00125         DiskBigImage() \{\}
00126         
00133         \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00134         \textcolor{keyword}{friend} boost::shared\_ptr<DiskBigImage<T> > load_disk_image(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *
      file\_name);
00135 
00136 \textcolor{keyword}{protected}:
00138         Size img_size;
00139 
00141         int64 file_node_size;
00142 
00144         int64 file_node_shift_num;
00145 
00147         boost::shared\_ptr<IndexMethodInterface> index_method;
00148 
00150         \textcolor{keywordtype}{size\_t} m_mini_rows, m\_mini\_cols;
00151 
00157         \textcolor{keywordtype}{size\_t} m_max_level;
00158 
00160         Size img_current_level_size;
00161 
00163         \textcolor{keywordtype}{size\_t} m_current_level;
00164 
00166         std::string img_data_path;
00167 
00169         std::string img_level_data_path;
00170 
00172         \textcolor{keywordtype}{size\_t} file_cache_number;
00173 
00175         ImageFileLRU<Vec3b> lru_image_files;
00176 \};
00177 
00178 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00179 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} DiskBigImage<T>::get_minimal_image_rows()\textcolor{keyword}{ const }
00180 \textcolor{keyword}{}\{
00181         \textcolor{keywordflow}{return} m\_mini\_rows;
00182 \}
00183 
00184 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00185 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} DiskBigImage<T>::get_minimal_image_cols()\textcolor{keyword}{ const }
00186 \textcolor{keyword}{}\{
00187         \textcolor{keywordflow}{return} m\_mini\_cols;
00188 \}
00189 
00190 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00191 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} DiskBigImage<T>::get_image_rows()\textcolor{keyword}{ const}
00192 \textcolor{keyword}{}\{
00193         \textcolor{keywordflow}{return} img\_size.rows;
00194 \}
00195 
00196 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00197 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} DiskBigImage<T>::get_image_cols()\textcolor{keyword}{ const}
00198 \textcolor{keyword}{}\{
00199         \textcolor{keywordflow}{return} img\_size.cols;
00200 \}
00201 
00207 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
