\section{Blockwise\-Image.\-h}
\label{_blockwise_image_8h}\index{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Blockwise\-Image.\-h@{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Blockwise\-Image.\-h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef \_BLOCKWISE\_IMAGE\_H}
00002 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define \_BLOCKWISE\_IMAGE\_H}
00003 \textcolor{preprocessor}{}
00004 \textcolor{preprocessor}{#pragma warning(disable:4307 4244 4250 4290 4800 4018 4204)}
00005 \textcolor{preprocessor}{}
00006 \textcolor{preprocessor}{#include "GiantImageInterface.h"}
00007 \textcolor{preprocessor}{#include "UtlityFunc.h"}
00008 
00009 \textcolor{preprocessor}{#include <string>}
00010 
00011 \textcolor{comment}{/* stxxl part */}
00012 \textcolor{preprocessor}{#include <stxxl.h>}
00013 \textcolor{preprocessor}{#ifdef NDEBUG}
00014 \textcolor{preprocessor}{}\textcolor{preprocessor}{#pragma comment(lib, "libstxxl\_release.lib")}
00015 \textcolor{preprocessor}{}\textcolor{preprocessor}{#else}
00016 \textcolor{preprocessor}{}\textcolor{preprocessor}{#pragma comment(lib, "libstxxl\_debug.lib")}
00017 \textcolor{preprocessor}{}\textcolor{preprocessor}{#endif}
00018 \textcolor{preprocessor}{}
00019 \textcolor{comment}{/* filesystem part */}
00020 \textcolor{preprocessor}{#define BOOST\_FILESYSTEM\_VERSION 3}
00021 \textcolor{preprocessor}{}\textcolor{preprocessor}{#include <boost/filesystem.hpp>}
00022 
00035 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{unsigned} memory\_usage = 64>
00036 \textcolor{keyword}{class }BlockwiseImage: \textcolor{keyword}{public} GiantImageInterface<T>
00037 \{
00038 \textcolor{keyword}{public}:
00039 
00052         BlockwiseImage(\textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} cols, \textcolor{keywordtype}{int} mini\_rows, \textcolor{keywordtype}{int} mini\_cols, 
00053                 boost::shared\_ptr<IndexMethodInterface> method = 
      boost::shared\_ptr<IndexMethodInterface>());
00054 
00055         \textcolor{keyword}{virtual} ~BlockwiseImage();
00056 
00057         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} init(\textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} cols);
00058         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} reset();
00059 
00063         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} write_image(\textcolor{keyword}{const} \textcolor{keywordtype}{char} *file\_name);
00064         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} write_image(\textcolor{keyword}{const} std::string &file\_name);
00065 
00066         \textcolor{keyword}{virtual} T& get_pixel(\textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} col);
00067         \textcolor{keyword}{virtual} \textcolor{keyword}{const} T& get_pixel(\textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} col) \textcolor{keyword}{const};
00068         \textcolor{keyword}{virtual} T& operator() (\textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} col);
00069         \textcolor{keyword}{virtual} \textcolor{keyword}{const} T& operator() (\textcolor{keywordtype}{int} row, \textcolor{keywordtype}{int} col) \textcolor{keyword}{const};
00070 
00071         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} get_pixels(\textcolor{keywordtype}{int} start\_row, \textcolor{keywordtype}{int} start\_col, \textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} 
      cols, std::vector<T> &data) \textcolor{keyword}{const};
00072         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} set\_pixels(\textcolor{keywordtype}{int} start\_row, \textcolor{keywordtype}{int} start\_col, \textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} 
      cols, \textcolor{keyword}{const} std::vector<T> &data);
00073 
00074         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} set\_pixels(\textcolor{keywordtype}{int} start\_row, \textcolor{keywordtype}{int} start\_col, \textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} 
      cols, \textcolor{keyword}{const} T clear\_value);
00075 
00076         \textcolor{keyword}{virtual} T& at(IndexMethodInterface::IndexType index);
00077         \textcolor{keyword}{virtual} \textcolor{keyword}{const} T& at(IndexMethodInterface::IndexType index) \textcolor{keyword}{const};
00078 
00079 \textcolor{keyword}{public}:
00083         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get_minimal_image_rows() \textcolor{keyword}{const};
00084         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get\_minimal\_image\_cols() \textcolor{keyword}{const};
00085 
00089         \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} get_max_image_level() \textcolor{keyword}{const};
00090 
00091 \textcolor{keyword}{protected}:
00092 
00096         \textcolor{keywordtype}{bool} write_image_head_file(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* file\_name);
00097 
00108         \textcolor{keywordtype}{void} set_minimal_resolution(\textcolor{keywordtype}{int} rows, \textcolor{keywordtype}{int} cols, \textcolor{keywordtype}{int} mini\_rows, \textcolor{keywordtype}{int} 
      mini\_cols);
00109 
00115         \textcolor{keyword}{virtual} \textcolor{keywordtype}{bool} save_mini_image(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* file\_name);
00116 
00117 \textcolor{keyword}{protected}:
00118 
00126         \textcolor{keyword}{typedef} stxxl::vector<T, 4, stxxl::lru\_pager<(memory\_usage >> 3)> >  
      ContainerType;
00127         ContainerType img\_container;
00128 
00129         \textcolor{keywordtype}{size\_t} m\_mini\_rows, m\_mini\_cols;
00130         \textcolor{keywordtype}{size\_t} m\_max\_level;
00131 \};
00132 
00133 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{unsigned} memory\_usage>
00134 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} BlockwiseImage<T, memory_usage>::get_minimal_image_rows()\textcolor{keyword}{ const}
00135 \textcolor{keyword}{}\{
00136         \textcolor{keywordflow}{return} m\_mini\_rows;
00137 \}
00138 
00139 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{unsigned} memory\_usage>
00140 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} BlockwiseImage<T, memory_usage>::get_minimal_image_cols()\textcolor{keyword}{ const}
00141 \textcolor{keyword}{}\{
00142         \textcolor{keywordflow}{return} m\_mini\_cols;
00143 \}
00144 
00145 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T, \textcolor{keywordtype}{unsigned} memory\_usage>
00146 \textcolor{keyword}{inline} \textcolor{keywordtype}{size\_t} BlockwiseImage<T, memory_usage>::get_max_image_level()\textcolor{keyword}{ const }
00147 \textcolor{keyword}{}\{
00148         \textcolor{keywordflow}{return} m\_max\_level;
00149 \}
00150 
00163 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00164 boost::shared\_ptr<GiantImageInterface<T> > get_block_wise_image_by_meomory_usage
      (\textcolor{keywordtype}{unsigned} memory\_usage,
00165         \textcolor{keywordtype}{size\_t} rows, \textcolor{keywordtype}{size\_t} cols, \textcolor{keywordtype}{size\_t} mini\_rows, \textcolor{keywordtype}{size\_t} mini\_cols, 
00166         boost::shared\_ptr<IndexMethodInterface> method = 
      boost::shared\_ptr<IndexMethodInterface>())
00167 \{
00168         \textcolor{comment}{/* ensure memory\_usage is bigger than 8 */}
00169         memory\_usage = (memory\_usage < 8) ? 8 : memory\_usage;
00170 
00171         \textcolor{comment}{/* make memory\_usage = 2^order (order >=3 && order <= 12) */}
00172         \textcolor{keywordflow}{while}(memory\_usage & (memory\_usage - 1)) \{
00173                 memory\_usage &= (memory\_usage - 1);
00174         \}
00175 
00176         \textcolor{keywordflow}{switch}(memory\_usage)
00177         \{
00178         \textcolor{keywordflow}{case} 8:
00179                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 8> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00180         \textcolor{keywordflow}{case} 16:
00181                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 16> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00182         \textcolor{keywordflow}{case} 32:
00183                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 32> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00184         \textcolor{keywordflow}{case} 64:
00185                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 64> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00186         \textcolor{keywordflow}{case} 128:
00187                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 128> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00188         \textcolor{keywordflow}{case} 256:
00189                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 256> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00190         \textcolor{keywordflow}{case} 512:
00191                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 512> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00192         \textcolor{keywordflow}{case} 1024:
00193                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 1024> >(rows, cols,
       mini\_rows, mini\_cols, method);
00194         \textcolor{keywordflow}{case} 2048:
00195                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 2048> >(rows, cols,
       mini\_rows, mini\_cols, method);
00196         \textcolor{keywordflow}{case} 4096:
00197                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 4096> >(rows, cols,
       mini\_rows, mini\_cols, method);
00198         \textcolor{keywordflow}{default}:
00199                 \textcolor{keywordflow}{return} boost::make\_shared<BlockwiseImage<T, 64> >(rows, cols, 
      mini\_rows, mini\_cols, method);
00200         \}
00201 \}
00202 
00213 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
