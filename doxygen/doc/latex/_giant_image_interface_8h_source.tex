\section{Giant\-Image\-Interface.\-h}
\label{_giant_image_interface_8h}\index{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Giant\-Image\-Interface.\-h@{D\-:/\-Out\-\_\-\-Of\-\_\-\-Core\-\_\-\-Git/src/\-Giant\-Image\-Interface.\-h}}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#ifndef \_GIANT\_IMAGE\_INTERFACE\_H}
00002 \textcolor{preprocessor}{}\textcolor{preprocessor}{#define \_GIANT\_IMAGE\_INTERFACE\_H}
00003 \textcolor{preprocessor}{}
00004 \textcolor{preprocessor}{#include "ImageInterface.h"}
00005 \textcolor{preprocessor}{#include "IndexMethodInterface.h"}
00006 \textcolor{preprocessor}{#include <boost/shared\_ptr.hpp>}
00007 \textcolor{preprocessor}{#include <boost/make\_shared.hpp>}
00008 
00018 \textcolor{keyword}{template}<\textcolor{keyword}{typename} T>
00019 \textcolor{keyword}{class }GiantImageInterface: \textcolor{keyword}{public} ImageInterface<T>
00020 \{
00021 \textcolor{keyword}{public}:
00022 
00026         GiantImageInterface(boost::shared\_ptr<IndexMethodInterface> method)
00027                 : index_method(method)
00028         \{
00029                 file_node_size = 1024*1024;             \textcolor{comment}{//default has 1M image
       cells in one file}
00030                 file_node_shift_num = 20;
00031         \}
00032 
00037         \textcolor{keywordtype}{void} set_file_node_size(int64 size)
00038         \{
00040                 size = int64(std::ceil((\textcolor{keywordtype}{double})(size) / \textcolor{keyword}{sizeof}(T)));
00041                 \textcolor{keywordflow}{while}(size & (size - 1)) \{
00042                         size &= (size - 1);
00043                 \}
00044 
00045                 file_node_size = size;
00046 
00047                 int64 count = 0;
00048                 \textcolor{keywordflow}{while}(size) \{
00049                         ++count;
00050                         size >>= 1;
00051                 \}
00052 
00054                 file_node_shift_num = count - 1;
00055                 file_node_shift_num = (file_node_shift_num < 0) ? 0 : 
      file_node_shift_num;
00056         \}
00057 
00058         int64 get\_file\_node\_size()\textcolor{keyword}{ const}
00059 \textcolor{keyword}{        }\{
00060                 \textcolor{keywordflow}{return} file_node_size * \textcolor{keyword}{sizeof}(T);
00061         \}
00062 
00067         \textcolor{keywordtype}{void} set_index_method(boost::shared\_ptr<IndexMethodInterface> method)
00068         \{
00069                 index_method = method;
00070         \}
00071 
00072         boost::shared\_ptr<IndexMethodInterface> get\_index\_method()\textcolor{keyword}{ const}
00073 \textcolor{keyword}{        }\{
00074                 \textcolor{keywordflow}{return} index_method;
00075         \}
00076 
00081         \textcolor{keyword}{virtual} T& at(IndexMethodInterface::IndexType index) = 0;
00082         \textcolor{keyword}{virtual} \textcolor{keyword}{const} T& at(IndexMethodInterface::IndexType index) \textcolor{keyword}{const} = 0;
00083 
00084 \textcolor{keyword}{protected}:
00085 
00087         int64 file_node_size;
00088 
00090         int64 file_node_shift_num;
00091 
00093         boost::shared\_ptr<IndexMethodInterface> index_method;
00094 \};
00095 
00096 \textcolor{preprocessor}{#endif}
\end{DoxyCode}
